// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id         Int      @id @default(autoincrement())
  email      String   @unique @db.VarChar(255)
  password   String   @db.VarChar(255)
  created_at DateTime @default(now()) @db.Timestamp(6)
  profiles   profiles?
  applications applications[]
}

model profiles {
  id                    Int      @id @default(autoincrement())
  user_id               Int      @unique
  user                  users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  full_name             String?  @db.VarChar(255)
  phone                 String?  @db.VarChar(50)
  job_title             String?  @db.VarChar(255)
  years_experience      Int?
  skills                String?  @db.Text
  target_roles          String?  @db.Text
  preferred_locations   String?  @db.Text
  salary_expectation    String?  @db.VarChar(100)
  company_preferences   String?  @db.Text
  resume                String?  @db.Text
  updated_at            DateTime @default(now()) @db.Timestamp(6)
}

model jobs {
  id             Int      @id @default(autoincrement())
  external_id    String?  @unique @db.VarChar(255)
  title          String   @db.VarChar(255)
  company        String   @db.VarChar(255)
  location       String?  @db.VarChar(255)
  salary         String?  @db.VarChar(100)
  job_type       String?  @db.VarChar(50)
  description    String?  @db.Text
  requirements   Json?    @db.JsonB
  url            String?  @db.Text
  source         String?  @db.VarChar(50)
  posted_date    DateTime? @db.Timestamp(6)
  scraped_at     DateTime @default(now()) @db.Timestamp(6)
  applications   applications[]
  
  @@index([posted_date(sort: Desc)], map: "idx_jobs_posted")
}

model applications {
  id            Int      @id @default(autoincrement())
  user_id       Int
  job_id        Int
  user          users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  job           jobs     @relation(fields: [job_id], references: [id], onDelete: Cascade)
  cover_letter  String?  @db.Text
  status        String?  @default("draft") @db.VarChar(50)
  match_score   Int?
  created_at    DateTime @default(now()) @db.Timestamp(6)
  submitted_at  DateTime? @db.Timestamp(6)
  
  @@index([user_id], map: "idx_applications_user")
}
